<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>camiseta</title>

  <link rel="stylesheet" href="../../style.css" />
  <link rel="stylesheet" href="../../ropa.css" />
</head>
<body>

  <header>
    <nav>
      <div class="logo"><h1>DressGchu</h1></div>
      <div class="user-area">
      </div>
    </nav>
  </header>

  <main class="detalle-producto">
    
    <div class="miniaturas">
      <img src="../../img/40.png" onclick="cambiarImagen(this.src)" alt="Vista 1" />
      <img src="../../img/40.png" onclick="cambiarImagen(this.src)" alt="Vista 2" />
      <img src="../../img/40.png" onclick="cambiarImagen(this.src)" alt="Vista 3" />
    </div>

    <div class="imagen-central">
      <img id="imagenPrincipal" src="../../img/40.png" alt="remera" />
    </div>

    <div class="info-producto">
      <h1>camiseta</h1>
      <p class="descripcion">Remera con tela suave, ideal para media estaciÃ³n.</p>
      <p class="precio">$10.000</p>
      <p class="cuotas">3 cuotas sin interÃ©s de $1.666</p>

      <label for="talle">Talle:</label>
      <select id="talle" class="select-talle">
        <option value="S">S</option>
        <option value="M">M</option>
        <option value="L">L</option>
        <option value="XL">XL</option>
      </select>

      <button onclick="guardarCompra()">Comprar</button>
      <p id="mensajeCarrito" style="color: green; font-weight: bold;"></p>
      <a href="../../cart.html" class="ver-carrito">Ver carrito â†’</a>

      <a href="../../productos/remeras.html" class="volver-arriba" title="Volver al inicio">
        <img src="https://cdn-icons-png.flaticon.com/512/507/507257.png" alt="Volver" width="24" height="24" />
      </a>
    </div>
  </main>

  <script type="module">
    import { supabase } from '../../supabaseClient.js';

    window.guardarCompra = async function () {
      const talle = document.getElementById('talle').value;
      const { data: { user }, error } = await supabase.auth.getUser();

      if (error || !user) {
        alert("TenÃ©s que iniciar sesiÃ³n primero.");
        window.location.href = "../../login.html";
        return;
      }

      if (!talle) {
        alert("SeleccionÃ¡ un talle antes de comprar.");
        return;
      }

      const fecha = new Date().toLocaleString("es-AR", {
        dateStyle: "short",
        timeStyle: "short"
      });

      const producto = {
        user_id: user.id,
        nombre: 'remera', // ðŸ‘ˆ nombre_producto
        precio: 10000, // ðŸ‘ˆ precio actualizado
        talle,
        fecha,
      };

      const { error: insertError } = await supabase.from('carrito').insert([producto]);

      if (insertError) {
        alert("Hubo un error al guardar ðŸ˜“");
        console.error(insertError);
      } else {
        const carrito = JSON.parse(localStorage.getItem("carrito")) || [];
        carrito.push({
          nombre: 'remera',         // ðŸ‘ˆ nombre_producto
          precio: 10000, // ðŸ‘ˆ precio actualizado
          talle
        });
        localStorage.setItem("carrito", JSON.stringify(carrito));

        document.getElementById("mensajeCarrito").textContent =
          `âœ… Compra guardada: talle ${talle} â€” ${fecha}`;
      }
    };
  </script>

  <footer>
    <div class="footer-logo">
      <a href="https://tudireccion.com" target="_blank" title="Ir al portfolio">
        <img src="https://cdn-icons-png.flaticon.com/512/3076/3076339.png" alt="Logo Hacker" />
      </a>
    </div>

    <div class="footer-nombre">
      <p>Â© 2025 Dress Indumentaria Deportiva</p>
    </div>

    <div class="redes-sociales">
      <a href="https://instagram.com/dressgchu_" target="_blank">
        <img src="https://cdn-icons-png.flaticon.com/512/6422/6422200.png" alt="Instagram" />
      </a>
      <a href="https://tiktok.com/@tucuenta" target="_blank">
        <img src="https://cdn-icons-png.flaticon.com/512/6422/6422207.png" alt="TikTok" />
      </a>
    </div>
  </footer>
</body>
</html>
